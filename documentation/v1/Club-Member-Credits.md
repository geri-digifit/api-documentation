# Club Member Credits
This resource allows for retrieving currently allocated credits and for further allocation of credits to members of a club.

|Method|URL|Info|URL-params|
|---|---|---|---|
|GET|/api/v1/club/`<club_id>`/credit/|Returns the credits of the member|api_key, club_secret, member_id, sync_from (timestamp in milliseconds)|
|PUT|/api/v1/club/`<club_id>`/credit/|Assign/add new credits to a member|api_key, club_secret|


## STRUCTURE

|Field|Type|Optional|Values|Information|
|---|---|---|---|---|
|member_id|int|yes| |The id of the member which checked in or out (either this field or the member_email must be in the PUT request body)|
|member_email|string|yes| | The email address of the member to add the credits too (either this field or the member_id must be in the PUT request body)|
|credit_amount|int|yes| |The amount of credits to add. Must be greater than 0 (either this field or credit_unlimited must be in the PUT request body)|
|credit_unlimited|boolean|yes|true/false|If value is true, unlimited credits are added to the user's account if he doesn't already have. If false, unlimited credits are removed if he already has (either this field or credit_amount must be in the PUT request body)|
|service_type|string|no| |Type of service (e.g. 'access', 'solarium'). The system automatically normalizes this value by converting it to lowercase and replacing any spaces with hyphens. Eg. ‘Test Credit’ becomes ‘test-credit’. Always use normalized values.|
|valid_until|date|yes|"2015-06-23" (Y-m-d)|Date till when the credits are valid. Leave empty for unlimited validity|
|notes|string|yes| |Description explaining why the credits are added (e.g. 'bought online'), max 200 chars if more are sent the string gets truncated|
|client_id|guid|no| |36 chars GUID generated by the requester of this API on a PUT request. This id is also used to filter out double postings, so you can easily sent the request two times(only the first will work)|

## GET Example

Send a GET request to `https://api.virtuagym.com/api/v1/club/<club_id>/credit?api_key=<api_key>&club_secret=<club_secret>&member_id=<member_id>&sync_from=<sync_from>`

The response is a paginated resulted of all the currently active credits. Each element in the paginated array corresponds to the credits in each service type of each member. 

```json
{
  "status": {
    "statuscode": 200,
    "statusmessage": "Everything OK",
    "result_count": 2,
    "timestamp": 1456499193200,
    "results_remaining": 0
  },
  "result": [
    {
      "club_id": 123,
      "member_id": 1234,
      "service_type": "drinks",
      "credit_amount": 260,
      "credit_unlimited": true,
      "ts_needs_update": 1469311199,
      "timestamp_created": 1454677501,
      "timestamp_edited": 1456498507
    },
    {
      "club_id": 123,
      "member_id": 1234,
      "service_type": "entries",
      "credit_amount": 20,
      "credit_unlimited": false,
      "timestamp_created": 1456499187,
      "timestamp_edited": 1456499187
    }
  ]
}
```


## PUT Example

Send the following json to `https://api.virtuagym.com/api/v1/club/<club_id>/credit?api_key=<api_key>&club_secret=<club_secret>`

It is to be noted that credits can only be allocated to one member for one service type at a time. Multiple requests must be made to allocate for multiple combinations.

```json
{
  "member_email":"example@example.com",
  "credit_amount":20,
  "service_type":"credits",
  "notes":"Online aankoop",
  "client_id":"fe4a87f4-d770-429a-8de1-69b87eed06c3" 
}
```


**PUT Response**

Success:
```json
{
  "status": {
    "statuscode": 200,
    "statusmessage": "Everything OK",
    "result_count": 2,
    "timestamp": 1435233640745
  },
  "result": {
    "member_id": 77118,
    "message": "Transaction completed"
  }
}
```

Already submitted request:
```json
{
  "status": {
    "statuscode": 200,
    "statusmessage": "Everything OK",
    "result_count": 2,
    "timestamp": 1435232830753
  },
  "result": {
    "member_id": 77118,
    "message": "Already picked up or completed"
  }
}
```

Member not found:
```json
{
  "statuscode": 420,
  "statusmessage": "no (active) member found",
  "result_count": 0,
  "timestamp": 1435233686
}
```

Required field missing or invalid data sent:
```json
{
  "statuscode": 420,
  "statusmessage": "member_email or member_id is required",
  "result_count": 0,
  "timestamp": 1435233729
}
```

## Possible error codes and messages

|Statuscode|Message|Description|
|---|---|---|
|420| |Member not found (based on given member_id or member_email)|
|420| |Invalid input (e.g. service_type doesn't exist)|
|420|Already picked up or completed|Same `client_id` is being passed for a different transaction and would not allow insert|
|420|user does not have unlimited credits for `service_type` to unset|user did not have unlimited credits and would not allow to unset|
|420|user does not have unlimited credits for `service_type` to set|user already had unlimited credits and would not allow for set|
